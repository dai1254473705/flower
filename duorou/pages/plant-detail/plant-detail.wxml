<!--pages/plant-detail/plant-detail.wxml-->
<view class="container {{currentTheme}}" style="font-size: {{fontSizeValue}}rpx;">
  <view wx:if="{{plant}}">
    <!-- æ¤ç‰©å¤§å›¾ -->
    <view class="plant-image-section">
      <image 
        class="plant-image" 
        src="{{plant.src}}" 
        mode="aspectFill"
        bindtap="previewImage"
      ></image>
      <view class="image-gradient">
        <view class="image-info">
          <text class="plant-title">{{plant.title}}</text>
          <text class="plant-subtitle" wx:if="{{plant.enTitle}}">{{plant.enTitle}}</text>
          <view class="category-tag">
            <text class="category-text">{{plant.category || 'æœªåˆ†ç±»'}}</text>
          </view>
        </view>
      </view>
      
      <!-- æ”¶è—æŒ‰é’® -->
      <view class="collection-btn" catchtap="toggleCollection">
        <text class="collection-icon {{isCollected ? 'collected' : ''}}">{{isCollected ? 'â™¥' : 'â™¡'}}</text>
        <text class="collection-text">{{isCollected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢ -->
    <view class="tab-container">
      <view class="tab-item {{currentTab === 'intro' ? 'active' : ''}}" bindtap="switchTab" data-tab="intro">
        <text class="tab-text">ç®€ä»‹</text>
      </view>
      <view class="tab-item {{currentTab === 'articles' ? 'active' : ''}}" bindtap="switchTab" data-tab="articles">
        <text class="tab-text">æ–‡ç« </text>
        <text class="tab-badge" wx:if="{{articleGroups && articleGroups.length > 0}}">{{totalArticlesCount}}</text>
      </view>
    </view>

    <!-- ç®€ä»‹å†…å®¹ -->
    <view class="content-wrapper" wx:if="{{currentTab === 'intro'}}">
      <!-- æœ‰å†…å®¹æ—¶æ˜¾ç¤º -->
      <block wx:if="{{hasIntroContent}}">
        <!-- æ¤ç‰©åç§°å±•ç¤º -->
        <view class="plant-name-section" wx:if="{{plant.englishName}}">
          <text class="plant-name-chinese">{{plant.title}}</text>
          <text class="plant-name-english">{{plant.englishName}}</text>
        </view>
        
        <!-- æ¤ç‰©ä»‹ç» -->
        <view class="info-section" wx:if="{{plant.introduction}}">
          <view class="section-header">
            <text class="section-title">æ¤ç‰©ä»‹ç»</text>
          </view>
          <view class="section-content">
            <text class="intro-text">{{plant.introduction}}</text>
          </view>
        </view>

        <!-- å½¢æ€ç‰¹å¾ -->
        <view class="info-section" wx:if="{{plant.morphology && plant.morphology.length > 0}}">
          <view class="section-header">
            <text class="section-title">å½¢æ€ç‰¹å¾</text>
          </view>
          <view class="section-content">
            <view class="feature-list">
              <view class="feature-item" wx:for="{{plant.morphology}}" wx:key="index">
                <text class="feature-bullet">â€¢</text>
                <text class="feature-text">{{item}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- å…»æŠ¤è¦ç‚¹ -->
        <view class="info-section" wx:if="{{plant.carePoints && plant.carePoints.length > 0}}">
          <view class="section-header">
            <text class="section-title">å…»æŠ¤è¦ç‚¹</text>
          </view>
          <view class="section-content">
            <view class="care-list">
              <view class="care-item" wx:for="{{plant.carePoints}}" wx:key="index">
                <text class="care-bullet">â€¢</text>
                <text class="care-text">{{item}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- å…»æŠ¤ä¿¡æ¯ç½‘æ ¼ -->
        <view class="info-section" wx:if="{{plant.careInfo}}">
          <view class="care-info-grid">
            <view class="care-info-item care-info-item-1" wx:if="{{plant.careInfo.wateringFrequency}}">
              <view class="care-info-label">æµ‡æ°´é¢‘ç‡</view>
              <view class="care-info-value">{{plant.careInfo.wateringFrequency}}</view>
            </view>
            <view class="care-info-item care-info-item-2" wx:if="{{plant.careInfo.lightRequirement}}">
              <view class="care-info-label">å…‰ç…§éœ€æ±‚</view>
              <view class="care-info-value">{{plant.careInfo.lightRequirement}}</view>
            </view>
            <view class="care-info-item care-info-item-3" wx:if="{{plant.careInfo.suitableTemperature}}">
              <view class="care-info-label">é€‚å®œæ¸©åº¦</view>
              <view class="care-info-value">{{plant.careInfo.suitableTemperature}}</view>
            </view>
            <view class="care-info-item care-info-item-4" wx:if="{{plant.careInfo.soilRequirement}}">
              <view class="care-info-label">åœŸå£¤è¦æ±‚</view>
              <view class="care-info-value">{{plant.careInfo.soilRequirement}}</view>
            </view>
          </view>
        </view>
      </block>
      
      <!-- ç©ºçŠ¶æ€å ä½ -->
      <view class="empty-intro" wx:else>
        <text class="empty-intro-icon">ğŸŒ±</text>
        <text class="empty-intro-text">æš‚æ— ç®€ä»‹ä¿¡æ¯</text>
        <text class="empty-intro-desc">è¯¥æ¤ç‰©çš„è¯¦ç»†ä¿¡æ¯æ­£åœ¨å®Œå–„ä¸­</text>
      </view>
    </view>

    <!-- æ–‡ç« åˆ—è¡¨ -->
    <view class="content-wrapper articles-section" wx:if="{{currentTab === 'articles'}}">
      <!-- æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º -->
      <view class="article-groups" wx:if="{{articleGroups && articleGroups.length > 0}}">
        <block wx:for="{{articleGroups}}" wx:key="type" wx:for-item="group">
          <view class="article-group">
            <view class="group-header">
              <text class="group-icon">{{group.icon}}</text>
              <text class="group-title">{{group.type}}</text>
              <text class="group-count">{{group.articles.length}}ç¯‡</text>
            </view>
            <view class="group-articles">
              <view 
                class="article-item" 
                wx:for="{{group.articles}}" 
                wx:key="id"
                wx:for-item="article"
                bindtap="viewArticle" 
                data-article="{{article}}"
              >
                <image 
                  wx:if="{{article.cover}}" 
                  class="article-cover" 
                  src="{{article.cover}}" 
                  mode="aspectFill"
                  lazy-load="{{true}}"
                ></image>
                <view class="article-info">
                  <text class="article-title">{{article.title}}</text>
                  <view class="article-meta" wx:if="{{article.publishTime || article.readCount}}">
                    <text wx:if="{{article.publishTime}}" class="article-time">{{article.publishTime}}</text>
                    <text wx:if="{{article.readCount}}" class="article-read">{{article.readCount}}é˜…è¯»</text>
                  </view>
                </view>
                <text class="article-arrow">â€º</text>
              </view>
            </view>
          </view>
        </block>
      </view>

      <!-- ç©ºçŠ¶æ€ - æ— ç›¸å…³æ–‡ç«  -->
      <view class="empty-articles" wx:if="{{!articleGroups || articleGroups.length === 0}}">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— ç›¸å…³æ–‡ç« </text>
      </view>
    </view>
    
    <!-- åé¦ˆæŒ‰é’® -->
    <view class="feedback-section">
      <button class="feedback-btn feedback-button" open-type="contact" session-from="plant_detail">
        <text class="feedback-icon">ğŸ’¬</text>
        <text class="feedback-text">å†…å®¹æœ‰è¯¯ï¼Ÿè”ç³»å®¢æœåé¦ˆ</text>
      </button>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty">
    <text class="empty-loading">æ¤ç‰©ä¿¡æ¯åŠ è½½ä¸­...</text>
  </view>
</view>