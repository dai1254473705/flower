# å¤šè‚‰èŠ±å›­å°ç¨‹åº - å®ç°æŒ‡å—

## ä¸€ã€å¿«é€Ÿå¼€å§‹

### 1.1 æ•°æ®å‡†å¤‡
1. åœ¨GitHubä»“åº“ä¸­åˆ›å»º`data`æ–‡ä»¶å¤¹
2. å°†`image-links.json`æ–‡ä»¶æ”¾å…¥`data`æ–‡ä»¶å¤¹
3. ç¡®ä¿GitHub Pageså·²å¯ç”¨
4. è®¿é—® `https://your-username.github.io/repo-name/data/image-links.json` éªŒè¯æ•°æ®å¯è®¿é—®

### 1.2 å°ç¨‹åºé…ç½®
1. åœ¨`app.js`ä¸­é…ç½®æ•°æ®æºURL
2. åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®ç½‘ç»œè¯·æ±‚åŸŸå
3. é…ç½®Webviewä¸šåŠ¡åŸŸåï¼ˆå…¬ä¼—å·æ–‡ç« åŸŸåï¼‰

---

## äºŒã€æ ¸å¿ƒåŠŸèƒ½å®ç°

### 2.1 æ–‡ç« ç±»å‹åˆ†ç»„æ˜¾ç¤º

#### 2.1.1 ä¿®æ”¹ plant-detail.wxml
```xml
<!-- ç›¸å…³æ–‡ç«  - æŒ‰ç±»å‹åˆ†ç»„ -->
<view class="articles-section" wx:if="{{plant.articles && plant.articles.length > 0}}">
  <view class="section-header">
    <text class="section-title">ç›¸å…³æ–‡ç« </text>
  </view>
  
  <!-- æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º -->
  <view class="article-groups">
    <block wx:for="{{articleGroups}}" wx:key="type">
      <view class="article-group">
        <view class="group-header">
          <text class="group-icon">{{item.icon}}</text>
          <text class="group-title">{{item.type}}</text>
          <text class="group-count">({{item.articles.length}})</text>
        </view>
        <view class="group-articles">
          <view 
            class="article-item" 
            wx:for="{{item.articles}}" 
            wx:key="id"
            wx:for-item="article"
            bindtap="viewArticle" 
            data-article="{{article}}"
          >
            <image 
              wx:if="{{article.cover}}" 
              class="article-cover" 
              src="{{article.cover}}" 
              mode="aspectFill"
            ></image>
            <view class="article-info">
              <text class="article-title">{{article.title}}</text>
              <view class="article-meta" wx:if="{{article.publishTime || article.readCount}}">
                <text wx:if="{{article.publishTime}}" class="article-time">{{article.publishTime}}</text>
                <text wx:if="{{article.readCount}}" class="article-read">{{article.readCount}}é˜…è¯»</text>
              </view>
            </view>
            <text class="article-arrow">â€º</text>
          </view>
        </view>
      </view>
    </block>
  </view>
</view>
```

#### 2.1.2 ä¿®æ”¹ plant-detail.js
```javascript
// åœ¨onLoadä¸­å¤„ç†æ–‡ç« åˆ†ç»„
onLoad(options) {
  if (options.plant) {
    const plant = JSON.parse(decodeURIComponent(options.plant))
    
    // å¤„ç†æ–‡ç« åˆ†ç»„
    const articleGroups = this.groupArticlesByType(plant.articles || [])
    
    this.setData({
      plant: plant,
      articleGroups: articleGroups,
      isCollected: this.checkCollectionStatus(plant.id)
    })
    
    wx.setNavigationBarTitle({
      title: plant.title || 'æ¤ç‰©è¯¦æƒ…'
    })
  }
},

// æŒ‰ç±»å‹åˆ†ç»„æ–‡ç« 
groupArticlesByType(articles) {
  const typeMap = {
    'ç§æ¤æ–¹æ³•': { icon: 'ğŸ“–', type: 'ç§æ¤æ–¹æ³•', articles: [] },
    'ç”Ÿæ´»ä¹ æ€§': { icon: 'ğŸŒ±', type: 'ç”Ÿæ´»ä¹ æ€§', articles: [] },
    'ç—…è™«å®³é˜²æ²»': { icon: 'ğŸ›', type: 'ç—…è™«å®³é˜²æ²»', articles: [] },
    'ç¹æ®–æŠ€å·§': { icon: 'ğŸŒ¿', type: 'ç¹æ®–æŠ€å·§', articles: [] },
    'å…»æŠ¤è¦ç‚¹': { icon: 'ğŸ’§', type: 'å…»æŠ¤è¦ç‚¹', articles: [] },
    'å“ç§ä»‹ç»': { icon: 'ğŸ“š', type: 'å“ç§ä»‹ç»', articles: [] },
    'å…¶ä»–': { icon: 'ğŸ“', type: 'å…¶ä»–', articles: [] }
  }
  
  articles.forEach(article => {
    const type = article.type || 'å…¶ä»–'
    if (typeMap[type]) {
      typeMap[type].articles.push(article)
    } else {
      typeMap['å…¶ä»–'].articles.push(article)
    }
  })
  
  // è¿‡æ»¤æ‰ç©ºçš„åˆ†ç»„ï¼Œå¹¶æŒ‰é¡ºåºè¿”å›
  return Object.values(typeMap).filter(group => group.articles.length > 0)
}
```

### 2.2 å¹¿å‘Šç»„ä»¶é›†æˆ

#### 2.2.1 åœ¨app.jsonä¸­é…ç½®å¹¿å‘Šç»„ä»¶
```json
{
  "usingComponents": {
    "ad-banner": "ad-unit",
    "ad-list": "ad-unit"
  }
}
```

#### 2.2.2 åœ¨é¡µé¢ä¸­ä½¿ç”¨Bannerå¹¿å‘Š
```xml
<!-- é¦–é¡µ - è½®æ’­å›¾ä¸‹æ–¹ -->
<view class="ad-section">
  <ad-banner 
    unit-id="your-banner-ad-unit-id"
    ad-type="banner"
    ad-theme="white"
  ></ad-banner>
</view>

<!-- è¯¦æƒ…é¡µ - æ–‡ç« åˆ—è¡¨ä¸Šæ–¹ -->
<view class="ad-section">
  <ad-banner 
    unit-id="your-banner-ad-unit-id"
    ad-type="banner"
    ad-theme="white"
  ></ad-banner>
</view>
```

#### 2.2.3 åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨ä¿¡æ¯æµå¹¿å‘Š
```xml
<!-- æ¤ç‰©åˆ—è¡¨ä¸­æ’å…¥å¹¿å‘Š -->
<view class="plant-item" wx:for="{{plants}}" wx:key="id">
  <!-- æ¤ç‰©å†…å®¹ -->
</view>

<!-- æ¯10æ¡æ’å…¥ä¸€æ¡å¹¿å‘Š -->
<view wx:if="{{index > 0 && index % 10 === 0}}" class="ad-item">
  <ad-list 
    unit-id="your-list-ad-unit-id"
    ad-type="list"
  ></ad-list>
</view>
```

### 2.3 æ•°æ®ç¼“å­˜ä¼˜åŒ–

#### 2.3.1 å®ç°æ™ºèƒ½ç¼“å­˜æ›´æ–°
```javascript
// utils/dataManager.js
const DATA_URL = 'https://dai1254473705.github.io/flower/data/image-links.json'
const CACHE_KEY = 'plantsData'
const VERSION_KEY = 'dataVersion'
const CACHE_TIME_KEY = 'dataCacheTime'
const CACHE_DURATION = 24 * 60 * 60 * 1000 // 24å°æ—¶

function getPlantsData() {
  return new Promise((resolve, reject) => {
    // å…ˆæ£€æŸ¥ç¼“å­˜
    const cachedData = wx.getStorageSync(CACHE_KEY)
    const cachedVersion = wx.getStorageSync(VERSION_KEY)
    const cacheTime = wx.getStorageSync(CACHE_TIME_KEY)
    
    // å¦‚æœç¼“å­˜å­˜åœ¨ä¸”æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›
    if (cachedData && cacheTime && (Date.now() - cacheTime < CACHE_DURATION)) {
      resolve(cachedData)
      // åå°æ›´æ–°
      updateDataInBackground()
      return
    }
    
    // ä»ç½‘ç»œè·å–
    wx.request({
      url: DATA_URL,
      success(res) {
        if (res.statusCode === 200 && res.data) {
          const newVersion = res.data.version || '1.0.0'
          
          // æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦æ›´æ–°
          if (newVersion !== cachedVersion) {
            // æ›´æ–°ç¼“å­˜
            wx.setStorageSync(CACHE_KEY, res.data)
            wx.setStorageSync(VERSION_KEY, newVersion)
            wx.setStorageSync(CACHE_TIME_KEY, Date.now())
          }
          
          resolve(res.data)
        } else {
          // ç½‘ç»œå¤±è´¥ï¼Œä½¿ç”¨ç¼“å­˜
          if (cachedData) {
            resolve(cachedData)
          } else {
            reject(new Error('æ•°æ®åŠ è½½å¤±è´¥'))
          }
        }
      },
      fail() {
        // ç½‘ç»œé”™è¯¯ï¼Œä½¿ç”¨ç¼“å­˜
        if (cachedData) {
          resolve(cachedData)
        } else {
          reject(new Error('ç½‘ç»œé”™è¯¯'))
        }
      }
    })
  })
}

function updateDataInBackground() {
  wx.request({
    url: DATA_URL,
    success(res) {
      if (res.statusCode === 200 && res.data) {
        const newVersion = res.data.version || '1.0.0'
        const cachedVersion = wx.getStorageSync(VERSION_KEY)
        
        if (newVersion !== cachedVersion) {
          wx.setStorageSync(CACHE_KEY, res.data)
          wx.setStorageSync(VERSION_KEY, newVersion)
          wx.setStorageSync(CACHE_TIME_KEY, Date.now())
          
          // é€šçŸ¥ç”¨æˆ·æœ‰æ›´æ–°
          wx.showToast({
            title: 'æ•°æ®å·²æ›´æ–°',
            icon: 'success',
            duration: 2000
          })
        }
      }
    },
    fail() {
      // é™é»˜å¤±è´¥ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ
    }
  })
}

module.exports = {
  getPlantsData,
  updateDataInBackground
}
```

#### 2.3.2 åœ¨é¡µé¢ä¸­ä½¿ç”¨
```javascript
// pages/index/index.js
const dataManager = require('../../utils/dataManager')

Page({
  onLoad() {
    this.loadPlants()
  },
  
  loadPlants() {
    this.setData({ loading: true })
    
    dataManager.getPlantsData()
      .then(data => {
        this.processPlantsData(data)
      })
      .catch(err => {
        wx.showToast({
          title: err.message || 'æ•°æ®åŠ è½½å¤±è´¥',
          icon: 'none'
        })
        this.setData({ loading: false })
      })
  }
})
```

### 2.4 å›¾ç‰‡æ‡’åŠ è½½ä¼˜åŒ–

#### 2.4.1 ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºåŸç”Ÿlazy-load
```xml
<image 
  class="plant-image" 
  src="{{plant.src}}" 
  mode="aspectFill"
  lazy-load="{{true}}"
  bindtap="previewImage"
></image>
```

### 2.5 æœç´¢åŠŸèƒ½å¢å¼º

#### 2.5.1 å®ç°æœç´¢é«˜äº®
```javascript
// utils/searchUtils.js
function highlightKeyword(text, keyword) {
  if (!keyword || !text) return text
  
  const regex = new RegExp(`(${keyword})`, 'gi')
  return text.replace(regex, '<mark>$1</mark>')
}

function searchPlants(plants, keyword) {
  if (!keyword) return []
  
  const lowerKeyword = keyword.toLowerCase()
  
  return plants.filter(plant => {
    // æœç´¢æ ‡é¢˜
    if (plant.title && plant.title.toLowerCase().includes(lowerKeyword)) {
      return true
    }
    
    // æœç´¢åˆ†ç±»
    if (plant.category && plant.category.toLowerCase().includes(lowerKeyword)) {
      return true
    }
    
    // æœç´¢æè¿°
    if (plant.description && plant.description.toLowerCase().includes(lowerKeyword)) {
      return true
    }
    
    // æœç´¢æ ‡ç­¾
    if (plant.tags && plant.tags.some(tag => tag.toLowerCase().includes(lowerKeyword))) {
      return true
    }
    
    return false
  })
}

module.exports = {
  highlightKeyword,
  searchPlants
}
```

---

## ä¸‰ã€æ ·å¼ä¼˜åŒ–

### 3.1 æ–‡ç« åˆ†ç»„æ ·å¼
```css
/* plant-detail.wxss */
.article-groups {
  padding: 20rpx;
}

.article-group {
  margin-bottom: 40rpx;
}

.group-header {
  display: flex;
  align-items: center;
  margin-bottom: 20rpx;
  padding-bottom: 10rpx;
  border-bottom: 2rpx solid #e0e0e0;
}

.group-icon {
  font-size: 32rpx;
  margin-right: 10rpx;
}

.group-title {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
}

.group-count {
  font-size: 24rpx;
  color: #999;
  margin-left: 10rpx;
}

.group-articles {
  padding-left: 20rpx;
}

.article-item {
  display: flex;
  align-items: center;
  padding: 20rpx;
  margin-bottom: 20rpx;
  background: #f9f9f9;
  border-radius: 10rpx;
}

.article-cover {
  width: 120rpx;
  height: 120rpx;
  border-radius: 8rpx;
  margin-right: 20rpx;
}

.article-info {
  flex: 1;
}

.article-title {
  font-size: 28rpx;
  color: #333;
  line-height: 1.5;
  margin-bottom: 10rpx;
}

.article-meta {
  display: flex;
  align-items: center;
  font-size: 22rpx;
  color: #999;
}

.article-time {
  margin-right: 20rpx;
}

.article-arrow {
  font-size: 40rpx;
  color: #ccc;
  margin-left: 20rpx;
}
```

### 3.2 å¹¿å‘Šæ ·å¼
```css
/* å¹¿å‘Šå®¹å™¨æ ·å¼ */
.ad-section {
  margin: 20rpx 0;
  padding: 20rpx;
  background: #fff;
  border-radius: 10rpx;
}

.ad-item {
  margin: 20rpx 0;
  padding: 20rpx;
  background: #f9f9f9;
  border-radius: 10rpx;
}
```

---

## å››ã€æµ‹è¯•è¦ç‚¹

### 4.1 åŠŸèƒ½æµ‹è¯•
- [ ] æ•°æ®åŠ è½½ï¼ˆç½‘ç»œæ­£å¸¸/å¤±è´¥/ç¦»çº¿ï¼‰
- [ ] æ–‡ç« åˆ†ç»„æ˜¾ç¤º
- [ ] æ–‡ç« è·³è½¬åˆ°webview
- [ ] æ”¶è—åŠŸèƒ½
- [ ] æœç´¢åŠŸèƒ½
- [ ] åˆ†ç±»ç­›é€‰
- [ ] ä¸»é¢˜åˆ‡æ¢
- [ ] å­—ä½“å¤§å°è°ƒæ•´

### 4.2 æ€§èƒ½æµ‹è¯•
- [ ] é¡µé¢åŠ è½½é€Ÿåº¦
- [ ] å›¾ç‰‡åŠ è½½é€Ÿåº¦
- [ ] åˆ—è¡¨æ»šåŠ¨æµç•…åº¦
- [ ] å†…å­˜å ç”¨

### 4.3 å…¼å®¹æ€§æµ‹è¯•
- [ ] ä¸åŒæœºå‹æµ‹è¯•
- [ ] ä¸åŒå¾®ä¿¡ç‰ˆæœ¬æµ‹è¯•
- [ ] ç½‘ç»œç¯å¢ƒæµ‹è¯•

---

## äº”ã€å‘å¸ƒå‰æ£€æŸ¥æ¸…å•

### 5.1 é…ç½®æ£€æŸ¥
- [ ] ç½‘ç»œè¯·æ±‚åŸŸåå·²é…ç½®
- [ ] Webviewä¸šåŠ¡åŸŸåå·²é…ç½®
- [ ] å¹¿å‘Šä½IDå·²é…ç½®
- [ ] å°ç¨‹åºåŸºæœ¬ä¿¡æ¯å·²å®Œå–„

### 5.2 å†…å®¹æ£€æŸ¥
- [ ] JSONæ•°æ®æ ¼å¼æ­£ç¡®
- [ ] æ‰€æœ‰å›¾ç‰‡é“¾æ¥æœ‰æ•ˆ
- [ ] æ‰€æœ‰æ–‡ç« é“¾æ¥æœ‰æ•ˆ
- [ ] å†…å®¹æ— è¿è§„ä¿¡æ¯

### 5.3 åŠŸèƒ½æ£€æŸ¥
- [ ] æ‰€æœ‰é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] ç”¨æˆ·ä½“éªŒæµç•…

### 5.4 åˆè§„æ£€æŸ¥
- [ ] éµå®ˆå¾®ä¿¡å°ç¨‹åºè§„èŒƒ
- [ ] å¹¿å‘Šå†…å®¹åˆè§„
- [ ] éšç§æ”¿ç­–å·²é…ç½®
- [ ] ç”¨æˆ·åè®®å·²é…ç½®

---

## å…­ã€å¸¸è§é—®é¢˜

### 6.1 æ•°æ®åŠ è½½å¤±è´¥
**é—®é¢˜ï¼š** æ— æ³•ä»GitHub PagesåŠ è½½æ•°æ®  
**è§£å†³ï¼š**
1. æ£€æŸ¥GitHub Pagesæ˜¯å¦å¯ç”¨
2. æ£€æŸ¥JSONæ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ç½‘ç»œè¯·æ±‚åŸŸåæ˜¯å¦é…ç½®
4. æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®

### 6.2 Webviewæ— æ³•æ‰“å¼€
**é—®é¢˜ï¼š** å…¬ä¼—å·æ–‡ç« æ— æ³•åœ¨webviewä¸­æ‰“å¼€  
**è§£å†³ï¼š**
1. æ£€æŸ¥Webviewä¸šåŠ¡åŸŸåæ˜¯å¦é…ç½®
2. æ£€æŸ¥æ–‡ç« URLæ ¼å¼æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿æ–‡ç« URLæ˜¯å…¬ä¼—å·æ–‡ç« é“¾æ¥

### 6.3 å¹¿å‘Šä¸æ˜¾ç¤º
**é—®é¢˜ï¼š** å¹¿å‘Šç»„ä»¶ä¸æ˜¾ç¤ºå¹¿å‘Š  
**è§£å†³ï¼š**
1. æ£€æŸ¥å¹¿å‘Šä½IDæ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ˜¯å¦å·²é€šè¿‡å¹¿å‘Šå®¡æ ¸
3. æ£€æŸ¥å¹¿å‘Šç»„ä»¶é…ç½®æ˜¯å¦æ­£ç¡®
4. ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæ–°ç”³è¯·çš„å¹¿å‘Šä½å¯èƒ½éœ€è¦æ—¶é—´ç”Ÿæ•ˆï¼‰

---

## ä¸ƒã€åç»­ä¼˜åŒ–å»ºè®®

### 7.1 åŠŸèƒ½å¢å¼º
- æ·»åŠ æ¤ç‰©å¯¹æ¯”åŠŸèƒ½
- æ·»åŠ å…»æŠ¤æé†’åŠŸèƒ½
- æ·»åŠ ç¤¾åŒºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- æ·»åŠ æ¤ç‰©è¯†åˆ«åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### 7.2 ä½“éªŒä¼˜åŒ–
- æ·»åŠ åŠ¨ç”»æ•ˆæœ
- ä¼˜åŒ–åŠ è½½ä½“éªŒ
- æ·»åŠ ç¦»çº¿æ¨¡å¼
- ä¼˜åŒ–åˆ†äº«åŠŸèƒ½

### 7.3 æ•°æ®åˆ†æ
- é›†æˆå¾®ä¿¡æ•°æ®åˆ†æ
- æ·»åŠ è‡ªå®šä¹‰åŸ‹ç‚¹
- åˆ†æç”¨æˆ·è¡Œä¸º
- ä¼˜åŒ–å†…å®¹ç­–ç•¥

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2024-01-01


